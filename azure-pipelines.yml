trigger:
- master

pool:
  vmImage: 'Ubuntu-16.04'

steps:
- script: |
    sudo apt-get -y install libreadline-dev
    sudo apt-get -y install perl re2c libboost-all-dev
  displayName: 'Install Packages'

- script: |
    make update
  displayName: 'Update git repos'

- script: |
    make release
  displayName: 'Make Release Files'

- script: |
    configure/modify_release.py ADSIMDETECTOR SET areaDetector/configure/RELEASE.local
    configure/modify_release.py ADFASTCCD     SET areaDetector/configure/RELEASE.local
    configure/modify_release.py ADPROSILICA   SET areaDetector/configure/RELEASE.local
  displayName: 'Modify AD Release File'
  
- script: |
    make 
  displayName: 'Build epics-modules'

# GitHub Release
# Create, edit, or delete a GitHub release.
- task: GitHubRelease@0
  inputs:
    gitHubConnection: NSLS-II
    repositoryName: NSLS-II/epics-modules
  displayName: ‘Create GitHub Release’
    #action: 'create' # Options: create, edit, delete
    #target: '$(Build.SourceVersion)' # Required when action == Create || Action == Edit
    #tagSource: 'auto' # Required when action == Create# Options: auto, manual
    #tag: # Required when action == Edit || Action == Delete || TagSource == Manual
    #title: # Optional
    #releaseNotesSource: 'file' # Optional. Options: file, input
    #releaseNotesFile: # Optional
    #releaseNotes: # Optional
    #assets: '$(Build.ArtifactStagingDirectory)/*' # Optional
    #assetUploadMode: 'delete' # Optional. Options: delete, replace
    #isDraft: false # Optional
    #isPreRelease: false # Optional
    #addChangeLog: true # Optional
